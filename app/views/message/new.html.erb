<link rel="stylesheet" href="https://uicdn.toast.com/tui-image-editor/latest/tui-image-editor.css">
<link type="text/css" href="https://uicdn.toast.com/tui-color-picker/latest/tui-color-picker.css" rel="stylesheet">
<script src="https://uicdn.toast.com/tui-color-picker/latest/tui-color-picker.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/3.6.0/fabric.js"></script>
<script src="https://uicdn.toast.com/tui.code-snippet/latest/tui-code-snippet.js"></script>
<script src="https://uicdn.toast.com/tui-image-editor/latest/tui-image-editor.js"></script>

<div class="container-sm mt-3">
  <div class="card shadow rounded">
    <div class="card-body">
      <h5 class="card-title">Send a Message</h5>
      <div class="card-text">
        <%= form_with(url: "/message/create", method: "post", html: {onsubmit: "validate()"}) do %>
          <div class="form-group">
            <%= label_tag(:recipient, "Recipient: ") %>
            <%= text_field_tag(:recipient, nil, class: "form-text") %>
          </div>
            <%= hidden_field(:message, :image) %>
          </div>
          <div class="form-group">
            <div id="tui-image-editor" style="height: 500px">
              <canvas></canvas>
            </div>
          </div>
          <%= submit_tag("Send", class: "btn btn-primary") %>
        <% end %>
      </div>
    </div>
  </div>
</div>
<script>
  //var ImageEditor = require('tui-image-editor');
//var FileSaver = require('file-saver'); //to download edited image to local. Use after npm install file-saver
//var blackTheme = require('./js/theme/black-theme.js');
var blackTheme = {

    // main icons
    'menu.normalIcon.color': '#8a8a8a',
    'menu.activeIcon.color': '#555555',
    'menu.disabledIcon.color': '#434343',
    'menu.hoverIcon.color': '#e9e9e9',
    'menu.iconSize.width': '24px',
    'menu.iconSize.height': '24px',

    // submenu icons
    'submenu.normalIcon.color': '#8a8a8a',
    'submenu.activeIcon.color': '#e9e9e9',
    'submenu.iconSize.width': '32px',
    'submenu.iconSize.height': '32px',

    // submenu primary color
    'submenu.backgroundColor': '#1e1e1e',
    'submenu.partition.color': '#3c3c3c',

    // submenu labels
    'submenu.normalLabel.color': '#8a8a8a',
    'submenu.normalLabel.fontWeight': 'lighter',
    'submenu.activeLabel.color': '#fff',
    'submenu.activeLabel.fontWeight': 'lighter',

    // checkbox style
    'checkbox.border': '0px',
    'checkbox.backgroundColor': '#fff',

    // range style
    'range.pointer.color': '#fff',
    'range.bar.color': '#666',
    'range.subbar.color': '#d1d1d1',

    'range.disabledPointer.color': '#414141',
    'range.disabledBar.color': '#282828',
    'range.disabledSubbar.color': '#414141',

    'range.value.color': '#fff',
    'range.value.fontWeight': 'lighter',
    'range.value.fontSize': '11px',
    'range.value.border': '1px solid #353535',
    'range.value.backgroundColor': '#151515',
    'range.title.color': '#fff',
    'range.title.fontWeight': 'lighter',

    // colorpicker style
    'colorpicker.button.border': '1px solid #1e1e1e',
    'colorpicker.title.color': '#fff'
};


var instance = new tui.ImageEditor('#tui-image-editor', {
  includeUI: {
    loadImage: {
        path: 'images/blankMessage.bmp',
        name: 'SampleImage'
    },
    theme: blackTheme, // or whiteTheme
    menuBarPosition: 'bottom',
},
    cssMaxWidth: 700,
    cssMaxHeight: 500
});

function validate(){
  console.log(instance);
  document.getElementById('message_image').value = instance.toDataURL();
}
</script>
